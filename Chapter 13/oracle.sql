-- Change the SYSTEM password
ALTER USER SYSTEM IDENTIFIED BY "Oradoc_db1";

-- Create test table
CREATE TABLE SYS.T1 (
  KEY INTEGER GENERATED BY DEFAULT AS IDENTITY,
  RANDOM_INT INTEGER,
  RANDOM_FLOAT FLOAT);

-- Populate table
DECLARE
  NUM_ROWS NUMBER := 1000000;
  START_VAL NUMBER := 1;
  END_VAL NUMBER := 10;
BEGIN
  INSERT INTO SYS.T1 (RANDOM_INT, RANDOM_FLOAT)
  SELECT DBMS_RANDOM.VALUE(START_VAL, END_VAL + 1), DBMS_RANDOM.VALUE(START_VAL, END_VAL + 1)
    FROM DUAL
  CONNECT BY LEVEL <= NUM_ROWS;
END;
/
COMMIT;

-- View queries being executed from PolyBase
COL SQL_TEXT FORMAT A1000;
SET LINESIZE 1000;
ALTER SESSION SET NLS_DATE_FORMAT = 'DD-MON-YYYY HH:MI:SS PM';
SELECT LAST_ACTIVE_TIME, SQL_TEXT
  FROM v$sql
 WHERE SQL_TEXT LIKE '%T1%'
 ORDER BY LAST_ACTIVE_TIME;

-- View query statistics if it's still in cache
SELECT SQL_FULLTEXT, SQL_ID, FIRST_LOAD_TIME, DISK_READS, ROWS_PROCESSED, CPU_TIME, ELAPSED_TIME
  FROM v$sql
 WHERE SQL_TEXT = 'SELECT 0 FROM "SYS"."T1"';

-- View query statistics if it's in AWR
SELECT SQL_TEXT, S.SQL_ID, SS.BEGIN_INTERVAL_TIME, DISK_READS_TOTAL,
       ROWS_PROCESSED_TOTAL, CPU_TIME_TOTAL, ELAPSED_TIME_TOTAL
  FROM DBA_HIST_SQLSTAT S
 INNER JOIN DBA_HIST_SQLTEXT T ON T.SQL_ID = S.SQL_ID
 INNER JOIN DBA_HIST_SNAPSHOT SS ON SS.SNAP_ID = S.SNAP_ID AND SS.INSTANCE_NUMBER = S.INSTANCE_NUMBER
 WHERE DBMS_LOB.COMPARE(SQL_TEXT,'SELECT 0 FROM "SYS"."T1"')=0;

-- Create partitioned table
CREATE TABLE SYS.T1 (
  KEY INTEGER GENERATED BY DEFAULT AS IDENTITY,
  RANDOM_INT INTEGER,
  RANDOM_FLOAT FLOAT)
PARTITION BY RANGE (RANDOM_INT)(
  PARTITION P1 VALUES LESS THAN (6),
  PARTITION P2 VALUES LESS THAN (11));
